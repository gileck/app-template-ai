name: Validate yarn.lock

on:
  pull_request:
    paths:
      - 'yarn.lock'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check for private Wix registry URLs
        run: |
          echo "üîç Checking yarn.lock for private registry URLs..."

          # Check if yarn.lock contains the private Wix registry
          if grep -q "npm.dev.wixpress.com" yarn.lock; then
            echo ""
            echo "‚ùå ERROR: yarn.lock contains private Wix registry URLs"
            echo ""
            echo "Found 'npm.dev.wixpress.com' in yarn.lock."
            echo "This will break Vercel deployments which cannot access the private registry."
            echo ""
            echo "This happened because dependencies were installed from the local"
            echo "corporate network, which uses the private npm registry."
            echo ""
            echo "To fix this PR:"
            echo "  git checkout origin/${{ github.base_ref }} -- yarn.lock"
            echo "  git commit -m 'chore: revert yarn.lock to remove private registry URLs'"
            echo "  git push"
            echo ""
            echo "If you need to update dependencies, ensure they come from public npm."
            echo ""
            exit 1
          fi

          echo "‚úÖ No private registry URLs found - yarn.lock is clean"
